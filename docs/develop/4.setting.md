设置
====

遵循【约定大于配置】的理念，提供默认设置以开箱即用，同时可以在后台管理设置。

---

## 设计思路

设置在数据结构上与字典非常相似，即在某一个表单（分组）下，包含多条数据（项目）。

设置的灵感来自 `Redmine` 的管理后台配置，可以配置的地方包括但不限于：

- 一般：网站标题、欢迎文字、网站作者、联系方式、版权声明、分页大小、日期格式、时间格式、日期时间格式
- 认证：认证开关、自动登录（30天）、自动注册、最短密码长度、密码规则、密码有效期、忘记密码开关
- 文件：附件大小限制、允许上传的附件类型、禁止上传的附件类型、附件名称编码规则

## 数据建模

设置数据属于热数据，需要在系统启动时，自动缓存全部数据，可以利用 Spring Cache 实现。

另外，当管理员从后台修改系统设置时，也可以利用 Spring Cache 对缓存进行同步。

```mermaid
erDiagram
    SettingForm ||--o{ SettingData : contain
    SettingForm {
        bigint id
        varchar name
        varchar code
    }
    SettingData {
        bigint id
        varchar label
        varchar type
        varchar style
        varchar name
        varchar value
        bigint parent_id
    }
```

### 设置类型

通过一对多关系包含设置数据列表。

- name 名称：用于设置的页面标签名称
- code 编码：页面标签的唯一标识

### 设置数据

- label 标签：用于输入框、选择框等表单元素的显示名称
- name 名称：用于输入框、选择框等表单元素的传参名称
- value 数值：用户操作的具体数值
- parent_id 父级：设置组的 id

## 注意事项

系统设置与 `application.yaml` 文件配置完全是两种概念，开发时一定要注意边界问题。

- `SysSetting`
    - 灵活
    - 改动频繁
    - 不涉及框架
    - 纯粹的代码逻辑
- `application.yaml`
    - 固定
    - 不能改动
    - 与框架有关
    - 系统运行的必备参数

### 举例说明

比如在 `application.yaml` 中配置的数据库参数，就不适合灵活配置以及经常改动，它和框架有关，更确切的说，它与数据库连接驱动有关，是系统运行的必备参数。

而系统设置的参数一般是账号锁定时长，又或者是邮件配置，甚至是前端的网页标题。

所以我们现在可以很快找到这两者的边界，即系统设置是运行规则，而 `application.yaml` 是程序参数。

**前者是系统运行过程中的配置项，后者是启动程序所需要的参数项。**